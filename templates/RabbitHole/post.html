{% extends 'RabbitHole/base.html' %}{% load static %}{% block css %}
<link rel="stylesheet" href="{% static 'RabbitHole/css/main.css'%}" />
{% endblock css %}

{% block content %}
<div class="container">
    <h1>{{post.room.name}} - post</h1>
</div>

<script>
function increaseLikes(postId) {
  var request = new XMLHttpRequest();
  request.open('GET', '/like_post/' + postId + '/');
  request.onload = function() {
    if (request.status === 200) {
      var data = JSON.parse(request.responseText);
      document.getElementById('likes-' + postId).innerHTML = data.likes;
    } else {
      console.log('Error: ' + request.status);
    }
  };
  request.send();
}
</script>

<div class="grid-container">
  <div class="grid-item"> empty</div>
  <div class="grid-item">
    <div> {{post.content}} </div>
    {% if post.image %}
        <hr>
        <img src="{{post.image.url}}" alt="{{post.room.name}}">
    {% endif %}
    {% if request.user in post.room.participants.all %}
      <div><button onclick="location.href='{% url 'create_reply' room_name=post.room.name post_id=post.id post_slug=post.slug %}'"> Reply </button></div>
    {% endif %}
    {% if replies %} {% for reply in replies %}
    <div> 
      <span><img src="{{reply.user.avatar.url}}" alt=""></span> <span> - {{reply.user.username}}</span>
      <p>
        {{reply.content}}
      </p>
    </div>
      <hr>
    {% endfor %}
    {% endif %}
    <hr>
  </div>
  <div class="grid-item">
    <img src="{{post.room.avatar.url}}" alt="{{post.room.name}}">
    <hr>
    <p>Likes: <span id="likes-{{ post.id }}">{{ post.countlikes }}</span></p>
    <button onclick="increaseLikes({{ post.id }})">Like</button>
    {{post.room.name}}
  </div>  
</div>
{% endblock content %}